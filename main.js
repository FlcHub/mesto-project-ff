(()=>{"use strict";function e(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function t(e){var t=document.querySelector(".popup_is-opened");e.target.closest(".popup__content")?e.target.classList.contains("popup__close")&&o(t):o(t)}function n(n){n.classList.add("popup_is-opened"),n.addEventListener("click",t),document.addEventListener("keydown",e)}function o(n){n.classList.remove("popup_is-opened"),n.removeEventListener("click",t),document.removeEventListener("keydown",e)}var r=document.querySelector("#card-template").content,c="element-hidden";function i(e,t,n,o,i){var l=r.querySelector(".places__item").cloneNode(!0),s=l.querySelector(".card__image");s.src=e.link,s.alt=e.name,l.querySelector(".card__description .card__title").textContent=e.name;var p=l.querySelector(".card__delete-button");p.addEventListener("click",(function(){return t(l,e._id)})),e.owner._id!==i&&p.classList.add(c);var d=l.querySelector(".card__like-button");return d.addEventListener("click",(function(){return n(d,l,e._id)})),u(l,e,i),a(l,e),s.addEventListener("click",(function(){return o(s)})),l}function u(e,t,n){var o=e.querySelector(".card__like-button").classList;!function(e,t){return e.likes.some((function(e){return e._id===t}))}(t,n)?o.remove("card__like-button_is-active"):o.add("card__like-button_is-active")}function a(e,t){var n=e.querySelector(".card__like-count"),o=function(e){return e.likes.length}(t);0!==o?(n.classList.remove(c),n.textContent=o):n.classList.add(c)}var l="5836099e-0d59-4a05-b782-cd4b7efbd404",s={method:"GET",headers:{authorization:l}};function p(e){return"https://nomoreparties.co/v1/".concat("wff-cohort-39","/").concat(e)}function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function _(e){return fetch(p("cards/likes/".concat(e)),{method:"PUT",headers:{authorization:l,"Content-Type":"application/json"}}).then(d)}function f(e){return fetch(p("cards/likes/".concat(e)),{method:"DELETE",headers:{authorization:l,"Content-Type":"application/json"}}).then(d)}function y(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}function v(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){y(e,n,t.inputErrorClass,t.errorClass)})),v(n,o,t.inactiveButtonClass)}var h,S=document.querySelector(".popup_type_image"),q=S.querySelector(".popup__image"),b=S.querySelector(".popup__caption"),C=document.querySelector(".places__list"),L=document.querySelector(".profile__image"),E=[],k={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},g=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),x=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_new-card"),A=x.querySelector(".popup__input_type_name"),z=x.querySelector(".popup__input_type_description"),B=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),w=document.querySelector(".popup_type_avatar"),D=w.querySelector(".popup__input_type_url"),N=j.querySelector(".popup__input_type_card-name"),O=j.querySelector(".popup__input_type_url");function J(e,t,n){(e.classList.contains("card__like-button_is-active")?f:_)(n).then((function(e){u(t,e,h),a(t,e)})).catch((function(e){console.log(e)}))}function M(e,t){(function(e){return fetch(p("cards/".concat(e)),{method:"DELETE",headers:{authorization:l,"Content-Type":"application/json"}}).then(d)})(t).then((function(){!function(e){e.remove()}(e)})).catch((function(e){console.log(e)}))}function H(e){L.style.backgroundImage="url(".concat(e,")")}function V(e,t){t.textContent=e?"Сохранение...":"Сохранение"}function G(e,t){B.textContent=e,P.textContent=t}function I(e){q.src=e.src,q.alt=e.alt,b.textContent=e.alt,n(S)}T.addEventListener("click",(function(e){m(j.querySelector(k.formSelector),k),n(j)})),g.addEventListener("click",(function(e){A.value=B.textContent,z.value=P.textContent,m(x.querySelector(k.formSelector),k),n(x)})),L.addEventListener("click",(function(e){m(w.querySelector(k.formSelector),k),n(w)})),x.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".popup__button");V(!0,r),(t=A.value,n=z.value,fetch(p("users/me"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(d)).then((function(e){G(e.name,e.about),o(x)})).catch((function(e){console.log(e)})).finally((function(){V(!1,r)}))})),w.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".popup__button");V(!0,n),(t=D.value,fetch(p("users/me/avatar"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(d)).then((function(e){H(e.avatar),o(w)})).catch((function(e){console.log(e)})).finally((function(){V(!1,n)}))})),j.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".popup__button");V(!0,t);var n=N.value,r=O.value;N.value="",O.value="",function(e,t){return fetch(p("cards"),{method:"POST",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then(d)}(n,r).then((function(e){var t=i(e,M,J,I,h);C.prepend(t),o(j)})).catch((function(e){console.log(e)})).finally((function(){V(!1,t)}))})),Promise.all([fetch(p("users/me"),s).then(d),fetch(p("cards"),s).then(d)]).then((function(e){var t=e[0];E=e[1],h=t._id,H(t.avatar),G(t.name,t.about),E.forEach((function(e){var t=i(e,M,J,I,h);C.append(t)}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?y(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,r,t.inputErrorClass,t.errorClass),v(n,o,t.inactiveButtonClass)}))})),v(n,o,t.inactiveButtonClass)}(t,e)}))}(k)})();