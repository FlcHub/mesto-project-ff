(()=>{"use strict";function e(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function t(e){var t=document.querySelector(".popup_is-opened");e.target.closest(".popup__content")?e.target.classList.contains("popup__close")&&o(t):o(t)}function n(n){n.classList.add("popup_is-opened"),n.addEventListener("click",t),document.addEventListener("keydown",e)}function o(n){n.classList.remove("popup_is-opened"),n.removeEventListener("click",t),document.removeEventListener("keydown",e)}var r=document.querySelector("#card-template").content;function c(e,t,n,o){var c=r.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image");a.src=e.link,a.alt=e.name,c.querySelector(".card__description .card__title").textContent=e.name,c.querySelector(".card__delete-button").addEventListener("click",(function(){t(c,e._id)}));var i=c.querySelector(".card__like-button");return i.addEventListener("click",(function(){n(i,c,e._id)})),a.addEventListener("click",(function(){o(a)})),c}var a="5836099e-0d59-4a05-b782-cd4b7efbd404",i={method:"GET",headers:{authorization:a}};function u(e){return"https://nomoreparties.co/v1/".concat("wff-cohort-39","/").concat(e)}function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function s(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}function p(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function d(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){s(e,n,t.inputErrorClass,t.errorClass)})),p(n,o,t.inactiveButtonClass)}var _=document.querySelector(".popup_type_image"),f=_.querySelector(".popup__image"),v=_.querySelector(".popup__caption"),y=document.querySelector(".places__list"),m=document.querySelector(".profile__image"),h="element-hidden",S=[],q=[];function b(e,t){var n=t.querySelector(".card__like-button").classList;!function(e){return e.likes.some((function(e){return e._id===q._id}))}(e)?n.remove("card__like-button_is-active"):n.add("card__like-button_is-active")}function C(e,t){var n=t.querySelector(".card__like-count"),o=e.likes.length;0!==o?(n.classList.remove(h),n.textContent=o):n.classList.add(h)}function L(e,t,n){e.classList.contains("card__like-button_is-active")?function(e){return fetch(u("cards/likes/".concat(e)),{method:"DELETE",headers:{authorization:a,"Content-Type":"application/json"}}).then(l)}(n).then((function(e){b(e,t),C(e,t)})).catch((function(e){console.log(e)})):function(e){return fetch(u("cards/likes/".concat(e)),{method:"PUT",headers:{authorization:a,"Content-Type":"application/json"}}).then(l)}(n).then((function(e){b(e,t),C(e,t)})).catch((function(e){console.log(e)}))}function E(e,t){(function(e){return e.owner._id===q._id})(e)||t.querySelector(".card__delete-button").classList.add(h)}function k(e,t){(function(e){return fetch(u("cards/".concat(e)),{method:"DELETE",headers:{authorization:a,"Content-Type":"application/json"}}).then(l)})(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))}function g(e){m.style.backgroundImage="url(".concat(e,")")}Promise.all([fetch(u("users/me"),i).then(l),fetch(u("cards"),i).then(l)]).then((function(e){q=e[0],S=e[1],g(q.avatar),O(q.name,q.about),S.forEach((function(e){var t=c(e,k,L,G);C(e,t),b(e,t),E(e,t),y.append(t)}))})).catch((function(e){console.log(e)}));var T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,r,t.inputErrorClass,t.errorClass),p(n,o,t.inactiveButtonClass)}))})),p(n,o,t.inactiveButtonClass)}(t,e)}))}(T);function x(e,t){t.textContent=e?"Сохранение...":"Сохранение"}var j=document.querySelector(".profile__edit-button"),A=document.querySelector(".profile__add-button"),z=document.querySelector(".popup_type_edit"),B=document.querySelector(".popup_type_new-card");A.addEventListener("click",(function(e){d(B.querySelector(T.formSelector),T),n(B)}));var P=z.querySelector(".popup__input_type_name"),w=z.querySelector(".popup__input_type_description"),D=document.querySelector(".profile__title"),N=document.querySelector(".profile__description");function O(e,t){D.textContent=e,N.textContent=t}z.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".popup__button");x(!0,r),(t=P.value,n=w.value,fetch(u("users/me"),{method:"PATCH",headers:{authorization:a,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(l)).then((function(e){q.name=e.name,q.about=e.about,O(q.name,q.about),o(z)})).catch((function(e){console.log(e)})).finally((function(){x(!1,r)}))})),j.addEventListener("click",(function(e){P.value=D.textContent,w.value=N.textContent,d(z.querySelector(T.formSelector),T),n(z)}));var J=document.querySelector(".popup_type_avatar"),M=J.querySelector(".popup__input_type_url");J.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".popup__button");x(!0,n),(t=M.value,fetch(u("users/me/avatar"),{method:"PATCH",headers:{authorization:a,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(l)).then((function(e){q.avatar=e.avatar,g(q.avatar),o(J)})).catch((function(e){console.log(e)})).finally((function(){x(!1,n)}))})),m.addEventListener("click",(function(e){M.value=q.avatar,d(J.querySelector(T.formSelector),T),n(J)}));var H=B.querySelector(".popup__input_type_card-name"),V=B.querySelector(".popup__input_type_url");function G(e){f.src=e.src,f.alt=e.alt,v.textContent=e.alt,n(_)}B.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".popup__button");x(!0,t);var n=H.value,r=V.value;H.value="",V.value="",function(e,t){return fetch(u("cards"),{method:"POST",headers:{authorization:a,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then(l)}(n,r).then((function(e){var t=c(e,k,L,G);b(e,t),C(e,t),E(e,t),y.prepend(t),o(B)})).catch((function(e){console.log(e)})).finally((function(){x(!1,t)}))}))})();